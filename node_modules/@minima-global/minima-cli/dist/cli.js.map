{"version":3,"sources":["../src/cli.ts","../src/utils/logger.ts"],"sourcesContent":["#!/usr/bin/env node\nimport chalk from \"chalk\"\nimport { Command } from \"commander\"\nimport { readFileSync } from \"fs\"\nimport ora, { type Ora } from \"ora\"\nimport { configureDappConf } from \"./scripts/dapp-conf.js\"\nimport { install } from \"./scripts/install.js\"\nimport { uninstall } from \"./scripts/uninstall.js\"\nimport { update } from \"./scripts/update.js\"\nimport { zip } from \"./scripts/zip.js\"\nimport { isReactProject } from \"./utils/is-react-project.js\"\nimport { logger } from \"./utils/logger.js\"\n\nconst program = new Command()\nconst version = JSON.parse(readFileSync(\"./package.json\", \"utf-8\")).version\n\nprogram\n  .name(\"minima\")\n  .description(\"CLI to manage Minima MiniDapps\")\n  .version(version)\n\nprogram\n  .command(\"zip\")\n  .description(\"Build and zip the MiniDapp\")\n  .option(\"-l, --logs\", \"Debug logs\", false)\n  .action(async (options) => {\n    const spinner = ora(\"Building MiniDapp...\").start()\n    try {\n      const packageJson = JSON.parse(readFileSync(\"./package.json\", \"utf-8\"))\n\n      await configureDappConf(options.logs)\n\n      spinner.text = \"Zipping MiniDapp...\"\n      const zipFileName = `${packageJson.name}-${packageJson.version}.mds.zip`\n      const filePath = isReactProject() ? \"build/\" : \"./\"\n\n      if (options.logs) {\n        console.log(\"filePath\", filePath)\n        console.log(\"zipFileName\", zipFileName)\n      }\n\n      await zip(zipFileName, filePath, options.logs)\n\n      setTimeout(() => {\n        spinner.succeed(\n          chalk.green(`MiniDapp built and zipped successfully! ${zipFileName}`)\n        )\n      }, 5000)\n    } catch (error) {\n      if (options.logs) {\n        console.log(\"error\", error)\n      }\n\n      spinner.fail(chalk.red(\"Failed to build and zip MiniDapp\"))\n      process.exit(1)\n    }\n  })\n\nprogram\n  .command(\"install\")\n  .description(\"Install the MiniDapp\")\n  .option(\"-p, --port <port>\", \"rpcport number\", \"9005\")\n  .action(async (options) => {\n    let installSpinner: Ora | undefined\n    try {\n      const packageJson = JSON.parse(readFileSync(\"./package.json\", \"utf-8\"))\n\n      installSpinner = ora(\"Installing MiniDapp...\").start()\n\n      await configureDappConf()\n\n      const zipFileName = `${packageJson.name}-${packageJson.version}.mds.zip`\n      const filePath = packageJson.template === \"react-ts\" ? \"build/\" : \"./\"\n\n      await zip(zipFileName, filePath)\n\n      await install({\n        port: parseInt(options.port),\n        pathToFile: process.cwd(),\n        miniDappName: packageJson.name,\n        miniDappVersion: packageJson.version,\n      })\n\n      setTimeout(() => {\n        installSpinner?.succeed(\"MiniDapp installed successfully!\")\n      }, 2000)\n    } catch (error) {\n      installSpinner?.fail(\"Failed to install MiniDapp\")\n      if (error instanceof Error) {\n        logger.error(error.message)\n        logger.info(`Port: ${options.port}`)\n        logger.info(\n          \"Please check that you have RPC enabled on your Minima node and that the port is correct\"\n        )\n        logger.info(\n          \"If you are using a custom port other than 9005, please use the -p option to specify the port\"\n        )\n      } else {\n        logger.error(String(error))\n      }\n      process.exit(1)\n    }\n  })\n\nprogram\n  .command(\"uninstall\")\n  .option(\"-p, --port <port>\", \"port number\", \"9005\")\n  .description(\"Uninstall the MiniDapp\")\n  .action(async (options) => {\n    let uninstallSpinner: Ora | undefined\n    try {\n      uninstallSpinner = ora(\"Uninstalling MiniDapp...\").start()\n      await uninstall({\n        port: parseInt(options.port),\n      })\n      setTimeout(() => {\n        uninstallSpinner?.succeed(\"MiniDapp uninstalled successfully!\")\n      }, 2000)\n    } catch (error) {\n      uninstallSpinner?.fail(\"Failed to uninstall MiniDapp\")\n      if (error instanceof Error) {\n        logger.error(error.message)\n        logger.info(`Port: ${options.port}`)\n        logger.info(\n          \"Please check that you have RPC enabled on your Minima node and that the port is correct\"\n        )\n        logger.info(\n          \"If you are using a custom port other than 9005, please use the -p option to specify the port\"\n        )\n      } else {\n        logger.error(String(error))\n      }\n      process.exit(1)\n    }\n  })\n\nprogram\n  .command(\"update\")\n  .description(\"Update the MiniDapp\")\n  .option(\"-p, --port <port>\", \"rpcport number\", \"9005\")\n  .action(async (options) => {\n    let updateSpinner: Ora | undefined\n    try {\n      const packageJson = JSON.parse(readFileSync(\"./package.json\", \"utf-8\"))\n      updateSpinner = ora(\"Updating MiniDapp...\").start()\n\n      // Configure the MiniDapp Dapp.conf\n      await configureDappConf()\n\n      // Get the zip file name\n      const zipFileName = `${packageJson.name}-${packageJson.version}.mds.zip`\n      const filePath = packageJson.template === \"react-ts\" ? \"build/\" : \"./\"\n\n      // Zip the MiniDapp\n      await zip(zipFileName, filePath)\n\n      // Update the MiniDapp\n      await update({\n        port: parseInt(options.port),\n      })\n      setTimeout(() => {\n        updateSpinner?.succeed(\"MiniDapp updated successfully!\")\n      }, 2000)\n    } catch (error) {\n      updateSpinner?.fail(\"Failed to update MiniDapp\")\n      if (error instanceof Error) {\n        logger.error(error.message)\n        logger.info(`Port: ${options.port}`)\n        logger.info(\n          \"Please check that you have RPC enabled on your Minima node and that the port is correct\"\n        )\n        logger.info(\n          \"If you are using a custom port other than 9005, please use the -p option to specify the port\"\n        )\n      } else {\n        logger.error(String(error))\n      }\n      process.exit(1)\n    }\n  })\n\nprogram.parse()\n","import chalk from \"chalk\"\n\nexport const logger = {\n  info: (message: string) => {\n    console.log(chalk.blue(message))\n  },\n  error: (message: string) => {\n    console.error(chalk.red(message))\n  },\n  success: (message: string) => {\n    console.log(chalk.green(message))\n  },\n  break: () => {\n    console.log(\"\")\n  },\n}\n"],"mappings":"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","names":["chalk","Command","readFileSync","ora","chalk","logger","message","program","Command","version","readFileSync","options","spinner","ora","packageJson","configureDappConf","zipFileName","filePath","isReactProject","zip","chalk","error","installSpinner","install","logger","uninstallSpinner","uninstall","updateSpinner","update"]}