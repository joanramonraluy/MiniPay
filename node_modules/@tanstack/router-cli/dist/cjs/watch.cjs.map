{"version":3,"file":"watch.cjs","sources":["../../src/watch.ts"],"sourcesContent":["import chokidar from 'chokidar'\nimport {\n  generator,\n  getConfig,\n  resolveConfigPath,\n} from '@tanstack/router-generator'\n\nexport function watch(root: string) {\n  const configPath = resolveConfigPath({\n    configDirectory: root,\n  })\n  const configWatcher = chokidar.watch(configPath)\n\n  let watcher = new chokidar.FSWatcher({})\n\n  const generatorWatcher = () => {\n    const config = getConfig()\n\n    watcher.close()\n\n    console.info(`TSR: Watching routes (${config.routesDirectory})...`)\n    watcher = chokidar.watch(config.routesDirectory)\n\n    watcher.on('ready', async () => {\n      const handle = async () => {\n        try {\n          await generator(config, root)\n        } catch (err) {\n          console.error(err)\n          console.info()\n        }\n      }\n\n      await handle()\n\n      let timeout: ReturnType<typeof setTimeout> | undefined\n\n      const deduped = (_file: string) => {\n        if (timeout) {\n          clearTimeout(timeout)\n        }\n\n        timeout = setTimeout(handle, 10)\n      }\n\n      watcher.on('change', deduped)\n      watcher.on('add', deduped)\n      watcher.on('unlink', deduped)\n    })\n  }\n\n  configWatcher.on('ready', generatorWatcher)\n  configWatcher.on('change', generatorWatcher)\n}\n"],"names":["resolveConfigPath","getConfig","generator"],"mappings":";;;;AAOO,SAAS,MAAM,MAAc;AAClC,QAAM,aAAaA,gBAAAA,kBAAkB;AAAA,IACnC,iBAAiB;AAAA,EAAA,CAClB;AACK,QAAA,gBAAgB,SAAS,MAAM,UAAU;AAE/C,MAAI,UAAU,IAAI,SAAS,UAAU,CAAA,CAAE;AAEvC,QAAM,mBAAmB,MAAM;AAC7B,UAAM,SAASC,gBAAAA,UAAU;AAEzB,YAAQ,MAAM;AAEd,YAAQ,KAAK,yBAAyB,OAAO,eAAe,MAAM;AACxD,cAAA,SAAS,MAAM,OAAO,eAAe;AAEvC,YAAA,GAAG,SAAS,YAAY;AAC9B,YAAM,SAAS,YAAY;AACrB,YAAA;AACI,gBAAAC,gBAAA,UAAU,QAAQ,IAAI;AAAA,iBACrB,KAAK;AACZ,kBAAQ,MAAM,GAAG;AACjB,kBAAQ,KAAK;AAAA,QAAA;AAAA,MAEjB;AAEA,YAAM,OAAO;AAET,UAAA;AAEE,YAAA,UAAU,CAAC,UAAkB;AACjC,YAAI,SAAS;AACX,uBAAa,OAAO;AAAA,QAAA;AAGZ,kBAAA,WAAW,QAAQ,EAAE;AAAA,MACjC;AAEQ,cAAA,GAAG,UAAU,OAAO;AACpB,cAAA,GAAG,OAAO,OAAO;AACjB,cAAA,GAAG,UAAU,OAAO;AAAA,IAAA,CAC7B;AAAA,EACH;AAEc,gBAAA,GAAG,SAAS,gBAAgB;AAC5B,gBAAA,GAAG,UAAU,gBAAgB;AAC7C;;"}